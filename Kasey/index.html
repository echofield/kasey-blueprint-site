<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POV Extrovert - Get Your Score</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #FAFAFA;
            --foreground: #303030;
            --muted: #545454;
            --accent: #FF6B6B;
            --accent-soft: #ff6b6b33;
            --border: #E4E4E7;
            --card-bg: #FFFFFF;
        }

        body {
            background-color: var(--background);
            color: var(--foreground);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .font-mono { font-family: 'IBM Plex Mono', monospace; }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 1200px;
            height: 1200px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, var(--accent-soft) 0%, rgba(250,250,250,0) 60%);
            z-index: -1;
        }

        /* New Button Styles */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
            border: 1px solid var(--border); padding: 12px 28px; font-size: 1rem;
            font-weight: 500; border-radius: 999px; color: var(--foreground);
            background-color: var(--card-bg); transition: all 0.3s ease;
            text-decoration: none; cursor: pointer;
        }
        .btn:hover { border-color: var(--muted); }
        .btn-primary {
            background: var(--accent); border-color: var(--accent);
            color: #FFFFFF; font-weight: 600;
        }
        .btn-primary:hover { background-color: #e94e77; border-color: #e94e77; }
        .btn-lg { padding: 16px 40px; font-size: 1.125rem; }

        /* Form Styling */
        .form-group {
            opacity: 0; visibility: hidden; position: absolute; width: 100%;
            transition: opacity 0.4s ease-in-out, visibility 0.4s;
        }
        .form-group.active {
            opacity: 1; visibility: visible; position: relative;
            animation: slideInUp 0.5s ease-out;
        }
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .form-input, textarea.form-input {
            width: 100%; padding: 14px; margin-bottom: 1rem; border: 1px solid var(--border);
            border-radius: 8px; background-color: var(--card-bg); color: var(--foreground);
            font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-input:focus, textarea.form-input:focus {
            outline: none; border-color: var(--accent);
            box-shadow: 0 0 0 3px var(--accent-soft);
        }
        .form-radio:checked + label {
            border-color: var(--accent);
            background-color: var(--accent-soft);
            color: var(--foreground);
            font-weight: 600;
        }
        .form-label {
            display: block;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--foreground);
        }

        /* Result Styles */
        .result-container {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2.5rem;
            max-width: 800px;
            margin: 2rem auto;
            box-shadow: 0 4px 25px rgba(0,0,0,0.05);
            text-align: left;
            border: 1px solid var(--border);
        }
        .result-container h2 {
            font-family: 'Inter', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: var(--foreground);
        }
        .result-container h3 {
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1.4rem;
            margin-top: 2rem;
            margin-bottom: 0.5rem;
            color: var(--foreground);
            border-bottom: 1px solid var(--border);
            padding-bottom: 0.5rem;
        }
        .result-container p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            line-height: 1.7;
            color: var(--muted);
        }
        .result-container strong {
            font-weight: 600;
            color: var(--accent);
        }
        .score-display {
            font-size: 5rem;
            font-weight: 800;
            color: var(--accent);
            text-align: center;
            margin-bottom: 0.5rem;
            line-height: 1;
        }
        
        /* Preloader Styles */
        #loader-container {
            position: fixed; inset: 0; z-index: 100; display: flex;
            align-items: center; justify-content: center;
            background-color: var(--background);
            transition: opacity 0.5s ease-in-out;
        }
        .loader { width: 80px; height: 50px; position: relative; }
        .loader-text {
            position: absolute; top: 0; padding: 0; margin: 0;
            color: var(--accent); animation: text_713 3.5s ease both infinite;
            font-size: .8rem; letter-spacing: 1px; font-family: 'IBM Plex Mono', monospace;
        }
        .load {
            background-color: var(--accent); border-radius: 50px; display: block;
            height: 16px; width: 16px; bottom: 0; position: absolute;
            transform: translateX(64px); animation: loading_713 3.5s ease both infinite;
        }
        .load::before {
            position: absolute; content: ""; width: 100%; height: 100%;
            background-color: #ffb8b8; border-radius: inherit;
            animation: loading2_713 3.5s ease both infinite;
        }
        @keyframes text_713 {
            0% { letter-spacing: 1px; transform: translateX(0px); }
            40% { letter-spacing: 2px; transform: translateX(26px); }
            80% { letter-spacing: 1px; transform: translateX(32px); }
            90% { letter-spacing: 2px; transform: translateX(0px); }
            100% { letter-spacing: 1px; transform: translateX(0px); }
        }
        @keyframes loading_713 {
            0% { width: 16px; transform: translateX(0px); }
            40% { width: 100%; transform: translateX(0px); }
            80% { width: 16px; transform: translateX(64px); }
            90% { width: 100%; transform: translateX(0px); }
            100% { width: 16px; transform: translateX(0px); }
        }
        @keyframes loading2_713 {
            0% { transform: translateX(0px); width: 16px; }
            40% { transform: translateX(0%); width: 80%; }
            80% { width: 100%; transform: translateX(0px); }
            90% { width: 80%; transform: translateX(15px); }
            100% { transform: translateX(0px); width: 16px; }
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <div id="loader-container">
        <div class="loader">
            <span class="loader-text">loading</span>
            <span class="load"></span>
        </div>
    </div>

    <div id="page-wrapper" class="opacity-0 transition-opacity duration-500">
        <main class="container mx-auto px-6">
            <section id="intro-section" class="hero-section min-h-screen flex flex-col items-center justify-center text-center py-20 relative">
                <div class="max-w-3xl">
                    <h1 class="font-mono text-xl md:text-2xl text-muted tracking-widest">POV: YOU'RE AN EXTROVERT</h1>
                    <p class="mt-8 text-4xl md:text-6xl font-bold text-foreground max-w-3xl tracking-tighter">Let’s see how extroverted you really are…</p>
                    <div class="mt-12 text-lg text-muted max-w-2xl mx-auto space-y-4">
                        <p>You’re not shy. <strong>You’re just underactivated.</strong></p>
                        <p>This ~2-minute audit reveals your true social energy. No fluff, just facts.</p>
                    </div>
                    <div class="mt-12">
                        <a href="#funnel-section" id="start-audit-btn" class="btn btn-primary btn-lg">
                            Get Your Extrovert Score
                        </a>
                    </div>
                </div>
            </section>

            <section id="funnel-section" class="min-h-screen flex items-center justify-center py-20">
                 <div id="funnel-container" class="w-full max-w-2xl"></div>
            </section>
        </main>
    </div>
    
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const funnelContainer = document.getElementById('funnel-container');
            const pageWrapper = document.getElementById('page-wrapper');
            const loaderContainer = document.getElementById('loader-container');
            let currentStep = 0;
            let userResult = {};
            
            window.addEventListener('load', () => {
                loaderContainer.style.opacity = '0';
                setTimeout(() => {
                    loaderContainer.style.display = 'none';
                    pageWrapper.classList.remove('opacity-0');
                }, 500);
            });
            
            // Added the two new open-ended questions
            const questions = [
                { id: 'social_energy', type: 'radio', prompt: "After a big social event, you feel:", options: ['Totally drained and need to be alone', 'A little tired, but happy', 'Energized and ready for more!'] },
                { id: 'party_behavior', type: 'radio', prompt: "At a party where you don't know many people, you're most likely to:", options: ['Find a quiet corner and observe', 'Stick close to the one person you know', 'Introduce yourself to someone new'] },
                { id: 'attention', type: 'radio', prompt: "Being the center of attention makes you feel:", options: ['Deeply uncomfortable', 'Okay with it in small doses', 'Secretly (or not-so-secretly) thrilled'] },
                { id: 'weekend_plan', type: 'radio', prompt: "Your ideal weekend involves:", options: ['A quiet night in, just for you', 'A small get-together with close friends', 'A big party or social event'] },
                { id: 'story_telling', type: 'radio', prompt: "When you tell a story, you tend to:", options: ['Keep it short and to the point', 'Add some fun details and gestures', 'Put on a full performance, voices and all'] },
                { id: 'goal', type: 'radio', prompt: "Why do you want to become more extroverted?", options: ['To connect more deeply', 'To express myself freely', 'To grow professionally', 'For fun, why not!'] },
                { id: 'self_image', type: 'radio', prompt: "What word best describes how you see yourself right now?", options: ['Creative', 'Shy', 'Curious', 'Confident', 'Invisible'] },
                { id: 'social_blockers', type: 'textarea', prompt: "What's holding you back from being more social?" },
                { id: 'favorite_energy', type: 'textarea', prompt: "Describe your energy after spending time with your favorite people." },
                { id: 'name', type: 'text', prompt: "Finally, what should we call you?" },
            ];
            const totalSteps = questions.length;

            function renderForm() {
                const formGroupsHtml = questions.map((q, index) => {
                    let groupContent = '';
                    if (q.type === 'text' || q.type === 'textarea') {
                        const inputElement = q.type === 'textarea'
                            ? `<textarea id="q-${q.id}" name="${q.id}" required class="form-input" rows="4" placeholder="Be as detailed as you like..."></textarea>`
                            : `<input type="text" id="q-${q.id}" name="${q.id}" required class="form-input">`;
                        
                        groupContent = `
                            <label for="q-${q.id}" class="form-label">${q.prompt}</label>
                            ${inputElement}
                        `;
                    } else if (q.type === 'radio') {
                        const optionsHtml = q.options.map((opt, i) => `
                            <div>
                                <input type="radio" name="${q.id}" id="${q.id}-${i}" value="${opt}" class="hidden form-radio" required>
                                <label for="${q.id}-${i}" class="block w-full cursor-pointer bg-card-bg border-2 border-border rounded-lg p-4 text-lg text-foreground hover:border-accent transition-colors duration-200">${opt}</label>
                            </div>
                        `).join('');
                        groupContent = `<label class="form-label">${q.prompt}</label><div class="space-y-3">${optionsHtml}</div>`;
                    }
                    return `<div class="form-group ${index === 0 ? 'active' : ''}" data-step="${index}">${groupContent}</div>`;
                }).join('');

                const formHtml = `
                    <form id="audit-form" class="relative min-h-[400px]">
                        ${formGroupsHtml}
                    </form>
                    <div id="form-navigation" class="mt-8 flex justify-between items-center">
                        <button type="button" id="prev-btn" class="btn" style="display: none;">← Back</button>
                        <span id="progress-indicator" class="font-mono text-muted">${currentStep + 1} / ${totalSteps}</span>
                        <button type="button" id="next-btn" class="btn btn-primary">Next →</button>
                    </div>`;
                
                funnelContainer.innerHTML = formHtml;
                addFormEventListeners();
            }

            function updateFormView() {
                document.querySelectorAll('.form-group').forEach((group, index) => group.classList.toggle('active', index === currentStep));
                document.getElementById('progress-indicator').textContent = `${currentStep + 1} / ${totalSteps}`;
                document.getElementById('prev-btn').style.display = currentStep > 0 ? 'inline-flex' : 'none';
                
                const nextBtn = document.getElementById('next-btn');
                if (nextBtn) {
                    nextBtn.textContent = currentStep === totalSteps - 1 ? 'Get My Score →' : 'Next →';
                }
            }

            function handleNext() {
                const currentGroup = document.querySelector(`.form-group[data-step="${currentStep}"]`);
                const input = currentGroup.querySelector('input[required], textarea[required]');
                
                let isValid = true;
                if (input.type === 'radio') {
                    if (!document.querySelector(`input[name="${input.name}"]:checked`)) {
                        isValid = false;
                    }
                } else {
                    if (!input.value.trim()) {
                        isValid = false;
                    }
                }

                if (!isValid) {
                    currentGroup.style.animation = 'shake 0.3s';
                    setTimeout(() => currentGroup.style.animation = '', 300);
                    return;
                }

                if (currentStep < totalSteps - 1) { 
                    currentStep++; 
                    updateFormView(); 
                } else {
                    handleFinalSubmit();
                }
            }

            function addFormEventListeners() {
                document.getElementById('next-btn')?.addEventListener('click', handleNext);
                document.getElementById('prev-btn')?.addEventListener('click', () => { if (currentStep > 0) { currentStep--; updateFormView(); } });
                
                document.querySelectorAll('input[type="text"], textarea').forEach(input => {
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault();
                            handleNext();
                        }
                    });
                });
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.addEventListener('change', () => setTimeout(handleNext, 250)));
            }

            async function handleFinalSubmit() {
                const form = document.getElementById('audit-form');
                const userAnswers = Object.fromEntries(new FormData(form).entries());
                
                funnelContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center text-center min-h-[400px]">
                        <div class="loader">
                            <span class="loader-text">analyzing</span>
                            <span class="load"></span>
                        </div>
                        <p class="font-mono text-muted mt-6">Auditing your social energy...</p>
                    </div>`;
                
                try {
                    const apiURL = new URL('/api/generate-extrovert-score', window.location.origin);
                    const response = await fetch(apiURL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(userAnswers)
                    });

                    if (!response.ok) {
                        throw new Error(`API request failed with status ${response.status}`);
                    }

                    userResult = await response.json();
                    showAIResults(userResult.resultHtml);

                } catch (error) {
                    console.error("Error during submission process: ", error);
                    funnelContainer.innerHTML = `<div class="text-center p-8"><h3 class="text-2xl font-bold text-red-600">ERROR</h3><p class="text-lg text-gray-600 mt-4">Could not generate your score. Please try again.</p></div>`;
                }
            }
            
            function showAIResults(resultHtml) {
                const html = `
                    <div class="result-container">
                        ${resultHtml}
                        <div class="mt-10 pt-8 border-t border-border text-center">
                             <h3 class="text-2xl font-bold text-foreground">Want to go further?</h3>
                             <p class="mt-4 text-muted">Unlock the <strong>POVEXTROVERT Bootcamp</strong>. A 5-day challenge to activate your social self.</p>
                             <div class="mt-8 flex flex-col sm:flex-row items-center justify-center gap-4">
                                <a href="https://gumroad.com" target="_blank" class="btn btn-primary btn-lg w-full sm:w-auto">Unlock The Bootcamp (€27)</a>
                                <button id="share-btn" class="btn w-full sm:w-auto">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
                                    Share Result
                                </button>
                             </div>
                        </div>
                    </div>`;
                funnelContainer.innerHTML = html;
                document.getElementById('share-btn')?.addEventListener('click', handleShare);
            }

            function handleShare() {
                if (navigator.share && userResult.shareData) {
                    navigator.share({
                        title: 'My Extrovert Archetype',
                        text: `I took the POV Extrovert test and I'm a ${userResult.shareData.archetype}! What's your social energy?`,
                        url: window.location.href
                    }).then(() => {
                        console.log('Thanks for sharing!');
                    }).catch(console.error);
                } else {
                    alert('Sharing is supported on mobile devices. Try sharing the page URL!');
                }
            }

            renderForm();
        });
    </script>
</body>
</html>
